<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script language="javascript">
        var exports = {};
    </script>
    <script language="javascript" src="crash.js"></script>
    <script language="javascript" src="game.js"></script>
    <script language="javascript">
        let cctx = new exports.CompileContext();
        let ectx = new exports.EvalContext(null, []);
        function process(event) {
            try {
                let text = $('textarea').val();
                let ast = exports.parseString(text, 'input', 1);
                let code = exports.convert(cctx, ast);
                code(ectx);
                $('textarea').val('');
                $('textarea').focus();
            } catch (e) {
                let pre = document.createElement('pre');
                pre.innerText = e.message;
                pre.setAttribute('class', 'error');
                console.log(e.stack);
                $('div').append(pre);
                $('textarea').val('');
                $('textarea').focus();
            }
        }
        function init() {
          registerGame(cctx);
            $('textarea').keypress((event) => {
                if ((event.which == 10 || event.which == 13) && event.ctrlKey)
                    process(event);
            });
            $('textarea').focus();
        }

    </script>
    <link rel="stylesheet" href="style.css" type="text/css">
  </head>
  <body onload="init()">
    <div>
    </div>
    <form action="javascript:process(event)">
        <textarea name="input" rows="10" cols="80"></textarea>
        <br>
        <button>Do it.</button>
    </form>
  </body>
</html>
